<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Roster</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* Copy all styles from index.html */
    </style>
</head>
<body>
    <h2 style="color: #2c3e50; border-bottom: 2px solid #4CAF50; padding-bottom: 10px;">
        STORE ROSTER
    </h2>

    <table id="rosterTable">
        <thead>
            <tr id="rosterHeader"></tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const SHEET_URL = "https://docs.google.com/spreadsheets/d/1aV9fmN_xkzaKTn-tKCXLS9-Vss_9Os9zkEtrVmoWFvE/export?format=csv";
        const urlParams = new URLSearchParams(window.location.search);
        const store = urlParams.get('store');

        async function loadData() {
            try {
                const response = await fetch(SHEET_URL);
                const csv = await response.text();
                const workbook = XLSX.read(csv, { type: 'string' });
                const sheet = workbook.Sheets[workbook.SheetNames[2]]; // Sheet3
                const data = XLSX.utils.sheet_to_json(sheet);

                // Get dynamic headers (dates) from the first row
                const headers = Object.keys(data[0]);
                const dateHeaders = headers.filter(header => header.match(/\d{2}-\w{3}-\d{2}/)); // Extract date headers

                // Build table header
                const headerRow = document.getElementById('rosterHeader');
                headerRow.innerHTML = `
                    <th>STORE NAME</th>
                    <th>HRMS</th>
                    <th>DESIGNATION</th>
                    <th>STAFF NAME</th>
                    ${dateHeaders.map(date => `<th>${date}</th>`).join('')}
                    <th>Remarks</th>
                `;

                // Filter by store
                const filteredData = data.filter(row => row['STORE NAME'] === store);
                
                // Build table rows
                const tbody = document.querySelector('#rosterTable tbody');
                tbody.innerHTML = filteredData.map(row => `
                    <tr>
                        <td>${row['STORE NAME']}</td>
                        <td>${row.HRMS}</td>
                        <td>${row.DESIGNATION}</td>
                        <td>${row['STAFF NAME']}</td>
                        ${dateHeaders.map(date => `<td>${row[date]}</td>`).join('')}
                        <td>${row.Remarks}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Failed to load roster data.');
            }
        }

        if (store) {
            loadData();
        } else {
            alert('No store specified in URL parameters.');
        }
    </script>
</body>
</html>
