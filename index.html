<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAMADAN INCENTIVE CALCULATOR</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #333; }
        select, input { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 12px 25px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .result { margin-top: 25px; padding: 20px; background-color: #f8f9fa; border-radius: 4px; }
        .admin-section { display: none; border: 2px solid #4CAF50; padding: 20px; margin-bottom: 20px; }
        input[readonly] { background-color: #f8f9fa !important; }
    </style>
</head>
<body>
    <h2 style="color: #2c3e50; border-bottom: 2px solid #4CAF50; padding-bottom: 10px;">
        RAMADAN INCENTIVE CALCULATOR
    </h2>

    <!-- Admin Login -->
    <div class="input-group">
        <button onclick="toggleAdminLogin()">Admin Login</button>
        <div id="adminLogin" style="display:none; margin-top:10px;">
            <input type="password" id="adminPassword" placeholder="Enter Admin Password">
            <button onclick="verifyAdmin()">Authenticate</button>
        </div>
    </div>

    <!-- Admin Section -->
    <div class="admin-section" id="adminSection">
        <h3>Admin Panel</h3>
        <div class="input-group">
            <label for="excelUpload">Upload Employee Data (Excel):</label>
            <input type="file" id="excelUpload" accept=".xlsx, .xls">
        </div>
    </div>

    <!-- User Interface -->
    <div class="input-group">
        <label for="area">Area:</label>
        <select id="area" onchange="updateAreaStores()">
            <option value="">Select Area</option>
        </select>
    </div>

    <div class="input-group">
        <label for="store">Store Name:</label>
        <select id="store" onchange="updateStoreEmployees()" disabled>
            <option value="">Select Store</option>
        </select>
    </div>

    <div class="input-group">
        <label for="employee">Employee (HRMS ID):</label>
        <select id="employee" onchange="updateEmployeeData()" disabled>
            <option value="">Select Employee</option>
        </select>
    </div>

    <div class="input-group">
        <label for="employeeName">Employee Name:</label>
        <input type="text" id="employeeName" readonly>
    </div>

    <div class="input-group">
        <label for="individualSales">Individual Sales (AED):</label>
        <input type="number" id="individualSales" readonly>
    </div>

    <div class="input-group">
        <label for="storeTarget">Store Target (AED):</label>
        <input type="number" id="storeTarget" readonly>
    </div>

    <div class="input-group">
        <label for="budgetAchievement">Budget Achievement (AED):</label>
        <input type="number" id="budgetAchievement" readonly>
    </div>

    <button onclick="calculateIncentive()">Calculate Incentive</button>
    <div class="result" id="result"></div>

    <script>
        // Admin Configuration
        const ADMIN_PASSWORD = "admin123"; // Change this if needed
        let employeeDataMap = new Map();
        let areaStoreMap = {};

        // Admin Functions
        function toggleAdminLogin() {
            let loginDiv = document.getElementById('adminLogin');
            loginDiv.style.display = loginDiv.style.display === 'block' ? 'none' : 'block';
        }

        function verifyAdmin() {
            let enteredPassword = document.getElementById('adminPassword').value;
            if (enteredPassword === ADMIN_PASSWORD) {
                document.getElementById('adminSection').style.display = 'block';
                document.getElementById('adminLogin').style.display = 'none';
                alert("Admin access granted!");
            } else {
                alert("Invalid password! Try again.");
            }
        }

        // Excel Handling
        document.getElementById('excelUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                areaStoreMap = {};
                employeeDataMap.clear();

                jsonData.forEach(row => {
                    const area = row['Area'];
                    const store = row['Store Location'];
                    const employee = {
                        id: row['HRMS ID'].toString(),
                        name: row['Employee Name'],
                        individualSales: row['Individual Sales'],
                        storeTarget: row['Store Target'],
                        budgetAchievement: row['Budget Achievement']
                    };

                    if (!areaStoreMap[area]) areaStoreMap[area] = {};
                    if (!areaStoreMap[area][store]) areaStoreMap[area][store] = [];
                    areaStoreMap[area][store].push({id: employee.id, name: employee.name});

                    employeeDataMap.set(employee.id, {
                        individualSales: employee.individualSales,
                        storeTarget: employee.storeTarget,
                        budgetAchievement: employee.budgetAchievement
                    });
                });

                initializeAreas();
                alert('Employee data updated successfully!');
            };
            reader.readAsArrayBuffer(file);
        });

        function initializeAreas() {
            const areaSelect = document.getElementById('area');
            areaSelect.innerHTML = '<option value="">Select Area</option>';
            Object.keys(areaStoreMap).forEach(area => {
                const option = document.createElement('option');
                option.value = area;
                option.textContent = area;
                areaSelect.appendChild(option);
            });
        }

        function updateAreaStores() {
            const area = document.getElementById('area').value;
            const storeSelect = document.getElementById('store');
            storeSelect.innerHTML = '<option value="">Select Store</option>';
            storeSelect.disabled = !area;
        }

        function updateStoreEmployees() {
            document.getElementById('employee').disabled = false;
        }

        function calculateIncentive() {
            alert("Calculation function needs to be implemented.");
        }
    </script>
</body>
</html>
